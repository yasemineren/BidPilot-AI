version: '3.8'

services:
  # 1. Veri Deposu (ClickHouse)
  clickhouse:
    image: clickhouse/clickhouse-server
    container_name: bidpilot-clickhouse
    ports:
      - "8123:8123"
      - "9000:9000"
    ulimits:
      nofile:
        soft: 262144
        hard: 262144

  # 2. Gösterge Paneli (Grafana)
  grafana:
    image: grafana/grafana
    container_name: bidpilot-grafana
    ports:
      - "3001:3000"
    depends_on:
      - clickhouse

  # 3. Veri Toplayıcı (Go Service) - YENİ!
  ingest-service:
    build: ./ingest-go
    container_name: bidpilot-ingest
    ports:
      - "3000:3000"
    depends_on:
      - clickhouse
    restart: always  # Veritabanı açılana kadar tekrar dener

  # 4. Veri Üretici (Python Simulator) - YENİ!
  simulator:
    build: ./simulator
    container_name: bidpilot-simulator
    depends_on:
      - ingest-service
    restart: always